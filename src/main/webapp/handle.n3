########################################################################
##  OpenHandle - Velocity Template for RDF/N3 Serialization of Handle
##
##  This is a Velocity template for an RDF/N3 serialization of a
##  Handle record as generated by OpenHandle [1]. The Handle System data
##  model is specified by RFC 3651 [2].  For further information on the
##  Handle System, see [3].
##
##  Author: Tony Hammond <t.hammond@nature.com>
##  Date:   2008-03-21T12:00:00Z
##
##  ==
##  [1] http://openhandle.googlecode.com/
##  [2] http://www.ietf.org/rfc/rfc3651.txt
##  [3] http://wwww.handle.net/
########################################################################
#set ($this = $request.getAttribute("id"))
#if ($request.getParameter("compact"))
#if ($request.getParameter("compact") == "false")
#else
#set ($compact = $request.getParameter("compact"))
#end
#else
#set ($compact = "true")
#end
# OpenHandle (RDF/N3) - see http://openhandle.googlecode.com/

@prefix h: <http://hdl.handle.net/10100/handle.rdfs#> .
@prefix r: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
 
<hdl:${this.handle}> a h:Handle ;
    h:handleValues  (
#foreach ($value in $this.values)
########################################################################
## Handle Value (Begin)
########################################################################
        [
########################################################################
## Handle Value Field - Index
########################################################################
            h:index "${value.index}" ;
########################################################################
## Handle Value Field - Type
########################################################################
            h:type "${value.type}" ;
########################################################################
## Handle Value Field - Data
########################################################################
#if (!$value.type.binary)
#if (${value.type} == "URL")
            h:data <${value.data}> ;
#else
            h:data "${value.data}" ;
#end
#elseif ($value.type.admin)
########################################################################
## Handle Value Field - Data (HS_ADMIN)
########################################################################
#if ($compact)
#foreach ($permission in $value.admin.permissions.entrySet())
#if ($permission.key == "readValue")#if (${permission.value}) #set ($readValue = "1")#else #set ($readValue = "0") #end#end
#if ($permission.key == "addNa")#if (${permission.value}) #set ($addNa = "1")#else #set ($addNa = "0") #end#end
#if ($permission.key == "deleteHandle")#if (${permission.value}) #set ($deleteHandle = "1")#else #set ($deleteHandle = "0") #end#end
#if ($permission.key == "addAdmin")#if (${permission.value}) #set ($addAdmin = "1")#else #set ($addAdmin = "0") #end#end
#if ($permission.key == "removeValue")#if (${permission.value}) #set ($removeValue = "1")#else #set ($removeValue = "0") #end#end
#if ($permission.key == "deleteNa")#if (${permission.value}) #set ($deleteNa = "1")#else #set ($deleteNa = "0") #end#end
#if ($permission.key == "addValue")#if (${permission.value}) #set ($addValue = "1")#else #set ($addValue = "0") #end#end
#if ($permission.key == "addHandle")#if (${permission.value}) #set ($addHandle = "1")#else #set ($addHandle = "0") #end#end
#if ($permission.key == "listHandles")#if (${permission.value}) #set ($listHandles = "1")#else #set ($listHandles = "0") #end#end
#if ($permission.key == "removeAdmin")#if (${permission.value}) #set ($removeAdmin = "1")#else #set ($removeAdmin = "0") #end#end
#if ($permission.key == "modifyValue")#if (${permission.value}) #set ($modifyValue = "1")#else #set ($modifyValue = "0") #end#end
#if ($permission.key == "modifyAdmin")#if (${permission.value}) #set ($modifyAdmin = "1")#else #set ($modifyAdmin = "0") #end#end
#end
          h:data [
                a h:HS_ADMIN ;
                h:adminRef <hdl:${this.handle}?index=${value.index}> ;
                h:adminPermission "${readValue}${addNa}${deleteHandle}${addAdmin}${removeValue}${deleteNa}${addValue}${addHandle}${listHandles}${removeAdmin}${modifyValue}${modifyAdmin}" ;
            ] ;
#else
            h:data [
                a h:HS_ADMIN ;
                h:adminRef [
                    a h:AdminRef ;
                    h:handle <hdl:${this.handle}> ;
                    h:handleValueIndex "${value.index}" ;
                ] ;
                h:adminPermission [
                    a h:AdminPermission ;
#foreach ($permission in $value.admin.permissions.entrySet())
                    h:${permission.key} "${permission.value}" ;
#end
                ]
            ] ;
#end
#elseif ($value.type.site)
########################################################################
## Handle Value Field - Data (HS_SITE)
########################################################################
            h:data [
                a h:HS_SITE ;
                h:version ${value.site.dataFormatVersion} ;
                h:protocolVersion [
                    a h:ProtocolVersion ;
                    h:majorProtocolVersion "${value.site.majorProtocolVersion}" ;
                    h:minorProtocolVersion "${value.site.minorProtocolVersion}" ;
                ] ;
                h:serialNumber "${value.site.serialNumber}" ;
                h:primaryMask [
                    a h:PrimaryMask ;
                    h:primary "${value.site.primary}" ;
                    h:multiPrimary "${value.site.multiPrimary}" ;
                ] ;
                h:hashOption "${value.site.hashOption}" ;
                h:hashFilter "${value.site.hashFilter}" ;
                h:attributes (
#foreach ($attribute in $value.site.attributes.entrySet())
                    [
                        a h:Attribute ;
                        h:name "${attribute.key}" ;
                        h:value "${attribute.value}" ;
                    ]
#end
                ) ;
                h:numOfServer "${value.site.servers.size()}" ;
                h:serverRecords (
#foreach ($server in $value.site.servers)
                    [
                        a h:ServerRecord ;
                        h:serverID ${server.id} ;
                        h:address ${server.address} ;
#if ($server.publicKey)
                        h:publicKeyRecord ${server.publicKey} ;
#end
                        h:serviceInterface [
                        a h:ServiceInterface ;
                        h:interfaceCounter $server.interfaces.size() ;
#foreach ($interface in $server.interfaces)
                        h:interface [
                            a h:Interface ;
                            h:serviceType ${interface.type} ;
                            h:transmissionProtocol ${interface.protocol} ;
                            h:portNumber ${interface.port} ;
                        ]
#end
                    ]
#end
                )
            ] ;
#elseif ($value.type.na_delegate)
########################################################################
## Handle Value Field - Data (HS_NA_DELEGATE)
########################################################################
            h:data [
                a h:HS_NA_DELEGATE ;
            ] ;
#elseif ($value.type.service)
########################################################################
## Handle Value Field - Data (HS_SERV)
########################################################################
            h:data [
                a h:HS_SERV ;
            ] ;
#elseif ($value.type.alias)
########################################################################
## Handle Value Field - Data (HS_ALIAS)
########################################################################
            h:data [
                a h:HS_ALIAS ;
            ] ;
#elseif ($value.type.primary)
########################################################################
## Handle Value Field - Data (HS_PRIMARY)
########################################################################
            h:data [
                a h:HS_PRIMARY ;
            ] ;
#elseif ($value.type.valueReferenceList)
########################################################################
## Handle Value Field - Data (HS_VLIST)
########################################################################
            h:data [
                a h:HS_VLIST ;
            ] ;
#end
########################################################################
## Handle Value Field - Permission
########################################################################
#if ($compact)
#if (${value.permissions.adminRead}) #set ($adminRead = "1")#else #set ($adminRead = "0") #end
#if (${value.permissions.adminWrite}) #set ($adminWrite = "1")#else #set ($adminWrite = "0") #end
#if (${value.permissions.publicRead}) #set ($publicRead = "1")#else #set ($publicRead = "0") #end
#if (${value.permissions.publicWrite}) #set ($publicWrite = "1")#else #set ($publicWrite = "0") #end
           h:permission "${adminRead}${adminWrite}${publicRead}${publicWrite}" ;
#else
            h:permission [
                a h:Permission ;
                h:adminRead "${value.permissions.adminRead}" ;
                h:adminWrite "${value.permissions.adminWrite}" ;
                h:publicRead "${value.permissions.publicRead}" ;
                h:publicWrite "${value.permissions.publicWrite}" ;
            ] ;
#end
########################################################################
## Handle Value Field - TTL
########################################################################
#if ($compact)
#if ($value.ttlType == "0") #set ($ttlType = "+") #else #set ($ttlType = "") #end
#set ($ttlValue = ${value.ttl})
           h:ttl "${ttlType}${ttlValue}" ;
#else
            h:ttl [
                a h:TTL ;
                h:ttlType "${value.ttlType}" ;
                h:ttlValue "${value.ttl}" ;
            ] ;
#end
########################################################################
## Handle Value Field - Timestamp
########################################################################
#if ($compact)
            h:timestamp "${value.timestamp}" ;
#else
            h:timestamp "${value.timestamp}" ;
#end
########################################################################
## Handle Value Field - Reference
########################################################################
#if ($compact)
            h:reference (##
#foreach ($reference in $value.valueReferences)
<hdl:${reference.handle}?index=${reference.index}/> ;
#end
)
#else
            h:reference [
                a h:Reference ;
                h:referenceCount "${value.references.size()}" ;
                h:referenceList (
#foreach ($reference in $value.valueReferences)
                    [
                        h:handle <hdl:${this.handle}> ;
                        h:handleValueIndex "${value.index}" ;
                    ]
#end
                )
            ]
#end
########################################################################
## Handle Value (End)
########################################################################
        ]
#end
    ) .
########################################################################
## EOF
########################################################################
