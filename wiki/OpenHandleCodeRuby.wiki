#summary Ruby code examples for OpenHandle

[OpenHandleCodeExamples Code Examples]
== OpenHandle Ruby Code Examples ==

It is expected that there could be an OpenHandle Ruby library but in the meantime OpenHandle can be accessed straightforwardly from native Ruby code.

Here's how a native Ruby program (contained in file "`handler.rb`") can grab a handle data record:

{{{
% cat handler.rb
require 'rubygems'    # only if "json" lib installed as gem
require 'json'
require 'open-uri'

OPENHANDLE = "http://nascent.nature.com/openhandle/handle"

uri = URI.parse("#{OPENHANDLE}?id=#{ARGV[0]}")
json = uri.open.read

h = JSON.parse(json)
values = h['handleValues']
s = "The handle <#{h['handle']}>"
s += " has #{values.length} values:\n"

1.upto(values.length) do |n|

  value = values[n-1]

  s += "\nvalue \##{n}:\n"
  s += "  index = #{value['index']}\n"
  s += "  type = #{value['type']}\n"
  if value['data'].class == String
    s += "  data = #{value['data']}\n"
  else
    s += "  data = [#{value['data'].class}]\n"
  end
  s += "  permission = #{value['permission']}\n"
  s += "  ttl = #{value['ttl'].to_i / 3600} hours\n"
  s += "  timestamp = #{value['timestamp']}\n"
  if value['reference'].length == 0
    s += "  reference = [#{value['reference'].class}]\n"
  else
    s += "  reference = [#{value['reference'].class}]\n"
  end

end
puts s
}}}

which can be run as

{{{
% ruby handler.rb 10.1038/nature05392
The handle <hdl:10.1038/nature05392> has 3 values:

value #1:
  index = 1
  type = URL
  data = http://www.nature.com/doifinder/10.1038/nature05392
  permission = 1110
  ttl = 24 hours
  timestamp = Wed Jan 10 18:08:30 GMT 2007
  reference = [Array]

value #2:
  index = 2
  type = 700050
  data = 20070110130704
  permission = 1110
  ttl = 24 hours
  timestamp = Wed Jan 10 18:08:30 GMT 2007
  reference = [Array]

value #3:
  index = 100
  type = HS_ADMIN
  data = [Hash]
  permission = 1110
  ttl = 24 hours
  timestamp = Wed Jan 10 18:08:30 GMT 2007
  reference = [Array]
}}}